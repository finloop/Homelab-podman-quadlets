http:
  services:
    auth-svc:
      loadBalancer:
        servers:
          - url: "http://192.168.1.61:9000"
    readeck-svc:
      loadBalancer:
        servers:
          - url: "http://192.168.1.61:9001"
    bookstack-svc:
      loadBalancer:
        servers:
          - url: "http://192.168.1.61:9002"


  routers:
    authentik:
      rule: "host(`auth.piotrk.it`)"
      entrypoints:
        - "web"
      middlewares:
        - "httpsHeader@file"
        - "cloudflareRealIP"
      service: auth-svc
    readeck:
      rule: "host(`read.piotrk.it`)"
      entrypoints:
        - "web"
      service: readeck-svc
    bookstack:
      rule: "host(`wiki.piotrk.it`)"
      entrypoints:
        - "web"
      service: bookstack-svc


  middlewares:
    httpsHeader:
      headers:
        customRequestHeaders:
          X-Forwarded-Proto: "https"
    cloudflareRealIP:
      plugin:
        htransformation:
          Rules:
            - Name: "Fix Real IP" 
              Header: "Cf-Connecting-Ip"
              Value: "X-Forwarded-For"
              Type: "Rename"
